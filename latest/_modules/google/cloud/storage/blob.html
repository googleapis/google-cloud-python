
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>google.cloud.storage.blob &#8212; google-cloud 295457a documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for google.cloud.storage.blob</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2014 Google LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="c1"># pylint: disable=too-many-lines</span>

<span class="sd">&quot;&quot;&quot;Create / interact with Google Cloud Storage blobs.</span>

<span class="sd">.. _API reference docs: https://cloud.google.com/storage/docs/\</span>
<span class="sd">                        json_api/v1/objects</span>
<span class="sd">.. _customer-supplied: https://cloud.google.com/storage/docs/\</span>
<span class="sd">                       encryption#customer-supplied</span>
<span class="sd">.. _google-resumable-media: https://googlecloudplatform.github.io/\</span>
<span class="sd">                            google-resumable-media-python/latest/\</span>
<span class="sd">                            google.resumable_media.requests.html</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="k">import</span> <span class="n">parse_qsl</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="k">import</span> <span class="n">quote</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="k">import</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="k">import</span> <span class="n">urlsplit</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="k">import</span> <span class="n">urlunsplit</span>

<span class="kn">from</span> <span class="nn">google</span> <span class="k">import</span> <span class="n">resumable_media</span>
<span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">ChunkedDownload</span>
<span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">Download</span>
<span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">MultipartUpload</span>
<span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">ResumableUpload</span>

<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="k">import</span> <span class="n">exceptions</span>
<span class="kn">from</span> <span class="nn">google.cloud._helpers</span> <span class="k">import</span> <span class="n">_rfc3339_to_datetime</span>
<span class="kn">from</span> <span class="nn">google.cloud._helpers</span> <span class="k">import</span> <span class="n">_to_bytes</span>
<span class="kn">from</span> <span class="nn">google.cloud._helpers</span> <span class="k">import</span> <span class="n">_bytes_to_unicode</span>
<span class="kn">from</span> <span class="nn">google.cloud.exceptions</span> <span class="k">import</span> <span class="n">NotFound</span>
<span class="kn">from</span> <span class="nn">google.cloud.iam</span> <span class="k">import</span> <span class="n">Policy</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._helpers</span> <span class="k">import</span> <span class="n">_PropertyMixin</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._helpers</span> <span class="k">import</span> <span class="n">_scalar_property</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage._signing</span> <span class="k">import</span> <span class="n">generate_signed_url</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage.acl</span> <span class="k">import</span> <span class="n">ACL</span>
<span class="kn">from</span> <span class="nn">google.cloud.storage.acl</span> <span class="k">import</span> <span class="n">ObjectACL</span>


<span class="n">_API_ACCESS_ENDPOINT</span> <span class="o">=</span> <span class="s1">&#39;https://storage.googleapis.com&#39;</span>
<span class="n">_DEFAULT_CONTENT_TYPE</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;application/octet-stream&#39;</span>
<span class="n">_DOWNLOAD_URL_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">u</span><span class="s1">&#39;https://www.googleapis.com/download/storage/v1</span><span class="si">{path}</span><span class="s1">?alt=media&#39;</span><span class="p">)</span>
<span class="n">_BASE_UPLOAD_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">u</span><span class="s1">&#39;https://www.googleapis.com/upload/storage/v1</span><span class="si">{bucket_path}</span><span class="s1">/o?uploadType=&#39;</span><span class="p">)</span>
<span class="n">_MULTIPART_URL_TEMPLATE</span> <span class="o">=</span> <span class="n">_BASE_UPLOAD_TEMPLATE</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;multipart&#39;</span>
<span class="n">_RESUMABLE_URL_TEMPLATE</span> <span class="o">=</span> <span class="n">_BASE_UPLOAD_TEMPLATE</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;resumable&#39;</span>
<span class="c1"># NOTE: &quot;acl&quot; is also writeable but we defer ACL management to</span>
<span class="c1">#       the classes in the google.cloud.storage.acl module.</span>
<span class="n">_CONTENT_TYPE_FIELD</span> <span class="o">=</span> <span class="s1">&#39;contentType&#39;</span>
<span class="n">_WRITABLE_FIELDS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;cacheControl&#39;</span><span class="p">,</span>
    <span class="s1">&#39;contentDisposition&#39;</span><span class="p">,</span>
    <span class="s1">&#39;contentEncoding&#39;</span><span class="p">,</span>
    <span class="s1">&#39;contentLanguage&#39;</span><span class="p">,</span>
    <span class="n">_CONTENT_TYPE_FIELD</span><span class="p">,</span>
    <span class="s1">&#39;crc32c&#39;</span><span class="p">,</span>
    <span class="s1">&#39;md5Hash&#39;</span><span class="p">,</span>
    <span class="s1">&#39;metadata&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">,</span>
    <span class="s1">&#39;storageClass&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">_NUM_RETRIES_MESSAGE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;`num_retries` has been deprecated and will be removed in a future &#39;</span>
    <span class="s1">&#39;release. The default behavior (when `num_retries` is not specified) when &#39;</span>
    <span class="s1">&#39;a transient error (e.g. 429 Too Many Requests or 500 Internal Server &#39;</span>
    <span class="s1">&#39;Error) occurs will be as follows: upload requests will be automatically &#39;</span>
    <span class="s1">&#39;retried. Subsequent retries will be sent after waiting 1, 2, 4, 8, etc. &#39;</span>
    <span class="s1">&#39;seconds (exponential backoff) until 10 minutes of wait time have &#39;</span>
    <span class="s1">&#39;elapsed. At that point, there will be no more attempts to retry.&#39;</span><span class="p">)</span>
<span class="n">_READ_LESS_THAN_SIZE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;Size </span><span class="si">{:d}</span><span class="s1"> was specified but the file-like object only had &#39;</span>
    <span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1"> bytes remaining.&#39;</span><span class="p">)</span>

<span class="n">_DEFAULT_CHUNKSIZE</span> <span class="o">=</span> <span class="mi">104857600</span>  <span class="c1"># 1024 * 1024 B * 100 = 100 MB</span>
<span class="n">_MAX_MULTIPART_SIZE</span> <span class="o">=</span> <span class="mi">8388608</span>  <span class="c1"># 8 MB</span>


<div class="viewcode-block" id="Blob"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob">[docs]</a><span class="k">class</span> <span class="nc">Blob</span><span class="p">(</span><span class="n">_PropertyMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A wrapper around Cloud Storage&#39;s concept of an ``Object``.</span>

<span class="sd">    :type name: str</span>
<span class="sd">    :param name: The name of the blob.  This corresponds to the unique path of</span>
<span class="sd">                 the object in the bucket. If bytes, will be converted to a</span>
<span class="sd">                 unicode object. Blob / object names can contain any sequence</span>
<span class="sd">                 of valid unicode characters, of length 1-1024 bytes when</span>
<span class="sd">                 UTF-8 encoded.</span>

<span class="sd">    :type bucket: :class:`google.cloud.storage.bucket.Bucket`</span>
<span class="sd">    :param bucket: The bucket to which this blob belongs.</span>

<span class="sd">    :type chunk_size: int</span>

<span class="sd">    :param chunk_size: The size of a chunk of data whenever iterating (in</span>
<span class="sd">                       bytes). This must be a multiple of 256 KB per the API</span>
<span class="sd">                       specification.</span>

<span class="sd">    :type encryption_key: bytes</span>
<span class="sd">    :param encryption_key:</span>
<span class="sd">        Optional 32 byte encryption key for customer-supplied encryption.</span>
<span class="sd">        See https://cloud.google.com/storage/docs/encryption#customer-supplied.</span>

<span class="sd">    :type kms_key_name: str</span>
<span class="sd">    :param kms_key_name:</span>
<span class="sd">        Optional resource name of Cloud KMS key used to encrypt the blob&#39;s</span>
<span class="sd">        contents.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_chunk_size</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Default value for each instance.</span>
    <span class="n">_CHUNK_SIZE_MULTIPLE</span> <span class="o">=</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">1024</span>
    <span class="sd">&quot;&quot;&quot;Number (256 KB, in bytes) that must divide the chunk size.&quot;&quot;&quot;</span>

    <span class="n">_STORAGE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;NEARLINE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MULTI_REGIONAL&#39;</span><span class="p">,</span>
        <span class="s1">&#39;REGIONAL&#39;</span><span class="p">,</span>
        <span class="s1">&#39;COLDLINE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;STANDARD&#39;</span><span class="p">,</span>  <span class="c1"># alias for MULTI_REGIONAL/REGIONAL, based on location</span>
    <span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Allowed values for :attr:`storage_class`.</span>

<span class="sd">    See</span>
<span class="sd">    https://cloud.google.com/storage/docs/json_api/v1/objects#storageClass</span>
<span class="sd">    https://cloud.google.com/storage/docs/per-object-storage-class</span>

<span class="sd">    .. note::</span>
<span class="sd">       This list does not include &#39;DURABLE_REDUCED_AVAILABILITY&#39;, which</span>
<span class="sd">       is only documented for buckets (and deprecated).</span>

<span class="sd">    .. note::</span>
<span class="sd">       The documentation does *not* mention &#39;STANDARD&#39;, but it is the value</span>
<span class="sd">       assigned by the back-end for objects created in buckets with &#39;STANDARD&#39;</span>
<span class="sd">       set as their &#39;storage_class&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">encryption_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kms_key_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_bytes_to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Blob</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>  <span class="c1"># Check that setter accepts value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acl</span> <span class="o">=</span> <span class="n">ObjectACL</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">encryption_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">kms_key_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Pass at most one of &#39;encryption_key&#39; &quot;</span>
                <span class="s2">&quot;and &#39;kms_key_name&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_encryption_key</span> <span class="o">=</span> <span class="n">encryption_key</span>

        <span class="k">if</span> <span class="n">kms_key_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="p">[</span><span class="s1">&#39;kmsKeyName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kms_key_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chunk_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the blob&#39;s default chunk size.</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: The current blob&#39;s chunk size, if it is set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span>

    <span class="nd">@chunk_size</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">chunk_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the blob&#39;s default chunk size.</span>

<span class="sd">        :type value: int</span>
<span class="sd">        :param value: (Optional) The current blob&#39;s chunk size, if it is set.</span>

<span class="sd">        :raises: :class:`ValueError` if ``value`` is not ``None`` and is not a</span>
<span class="sd">                 multiple of 256 KB.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
                <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> \
                <span class="n">value</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CHUNK_SIZE_MULTIPLE</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Chunk size must be a multiple of </span><span class="si">%d</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_CHUNK_SIZE_MULTIPLE</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Blob.path_helper"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.path_helper">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">path_helper</span><span class="p">(</span><span class="n">bucket_path</span><span class="p">,</span> <span class="n">blob_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Relative URL path for a blob.</span>

<span class="sd">        :type bucket_path: str</span>
<span class="sd">        :param bucket_path: The URL path for a bucket.</span>

<span class="sd">        :type blob_name: str</span>
<span class="sd">        :param blob_name: The name of the blob.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: The relative URL path for ``blob_name``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">bucket_path</span> <span class="o">+</span> <span class="s1">&#39;/o/&#39;</span> <span class="o">+</span> <span class="n">_quote</span><span class="p">(</span><span class="n">blob_name</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">acl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create our ACL on demand.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acl</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">:</span>
            <span class="n">bucket_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bucket_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="s1">&#39;&lt;Blob: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Getter property for the URL path to this Blob.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: The URL path to this Blob.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot determine path without a blob name.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The client bound to this blob.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">client</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Project ID billed for API requests made via this blob.</span>

<span class="sd">        Derived from bucket&#39;s value.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">user_project</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">public_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The public URL for this blob.</span>

<span class="sd">        Use :meth:`make_public` to enable anonymous access via the returned</span>
<span class="sd">        URL.</span>

<span class="sd">        :rtype: `string`</span>
<span class="sd">        :returns: The public URL for this blob.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{storage_base_url}</span><span class="s1">/</span><span class="si">{bucket_name}</span><span class="s1">/</span><span class="si">{quoted_name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">storage_base_url</span><span class="o">=</span><span class="n">_API_ACCESS_ENDPOINT</span><span class="p">,</span>
            <span class="n">bucket_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">quoted_name</span><span class="o">=</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)))</span>

<div class="viewcode-block" id="Blob.generate_signed_url"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.generate_signed_url">[docs]</a>    <span class="k">def</span> <span class="nf">generate_signed_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expiration</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
                            <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">generation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">response_disposition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">response_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates a signed URL for this blob.</span>

<span class="sd">        .. note::</span>

<span class="sd">            If you are on Google Compute Engine, you can&#39;t generate a signed</span>
<span class="sd">            URL using GCE service account. Follow `Issue 50`_ for updates on</span>
<span class="sd">            this. If you&#39;d like to be able to generate a signed URL from GCE,</span>
<span class="sd">            you can use a standard service account from a JSON file rather</span>
<span class="sd">            than a GCE service account.</span>

<span class="sd">        .. _Issue 50: https://github.com/GoogleCloudPlatform/\</span>
<span class="sd">                      google-auth-library-python/issues/50</span>

<span class="sd">        If you have a blob that you want to allow access to for a set</span>
<span class="sd">        amount of time, you can use this method to generate a URL that</span>
<span class="sd">        is only valid within a certain time period.</span>

<span class="sd">        This is particularly useful if you don&#39;t want publicly</span>
<span class="sd">        accessible blobs, but don&#39;t want to require users to explicitly</span>
<span class="sd">        log in.</span>

<span class="sd">        :type expiration: int, long, datetime.datetime, datetime.timedelta</span>
<span class="sd">        :param expiration: When the signed URL should expire.</span>

<span class="sd">        :type method: str</span>
<span class="sd">        :param method: The HTTP verb that will be used when requesting the URL.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: (Optional) The content type of the object</span>
<span class="sd">                             referenced by ``resource``.</span>

<span class="sd">        :type generation: str</span>
<span class="sd">        :param generation: (Optional) A value that indicates which generation</span>
<span class="sd">                           of the resource to fetch.</span>

<span class="sd">        :type response_disposition: str</span>
<span class="sd">        :param response_disposition: (Optional) Content disposition of</span>
<span class="sd">                                     responses to requests for the signed URL.</span>
<span class="sd">                                     For example, to enable the signed URL</span>
<span class="sd">                                     to initiate a file of ``blog.png``, use</span>
<span class="sd">                                     the value</span>
<span class="sd">                                     ``&#39;attachment; filename=blob.png&#39;``.</span>

<span class="sd">        :type response_type: str</span>
<span class="sd">        :param response_type: (Optional) Content type of responses to requests</span>
<span class="sd">                              for the signed URL. Used to over-ride the content</span>
<span class="sd">                              type of the underlying blob/object.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>


<span class="sd">        :type credentials: :class:`oauth2client.client.OAuth2Credentials` or</span>
<span class="sd">                           :class:`NoneType`</span>
<span class="sd">        :param credentials: (Optional) The OAuth2 credentials to use to sign</span>
<span class="sd">                            the URL. Defaults to the credentials stored on the</span>
<span class="sd">                            client used.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: A signed URL you can use to access the resource</span>
<span class="sd">                  until expiration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="s1">&#39;/</span><span class="si">{bucket_name}</span><span class="s1">/</span><span class="si">{quoted_name}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">bucket_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">quoted_name</span><span class="o">=</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_credentials</span>

        <span class="k">return</span> <span class="n">generate_signed_url</span><span class="p">(</span>
            <span class="n">credentials</span><span class="p">,</span>
            <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
            <span class="n">api_access_endpoint</span><span class="o">=</span><span class="n">_API_ACCESS_ENDPOINT</span><span class="p">,</span>
            <span class="n">expiration</span><span class="o">=</span><span class="n">expiration</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
            <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
            <span class="n">response_type</span><span class="o">=</span><span class="n">response_type</span><span class="p">,</span>
            <span class="n">response_disposition</span><span class="o">=</span><span class="n">response_disposition</span><span class="p">,</span>
            <span class="n">generation</span><span class="o">=</span><span class="n">generation</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.exists"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines whether or not this blob exists.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        :returns: True if the blob exists in Cloud Storage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="c1"># We only need the status code (200 or not) so we seek to</span>
        <span class="c1"># minimize the returned payload.</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="s1">&#39;name&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;userProject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># We intentionally pass `_target_object=None` since fields=name</span>
            <span class="c1"># would limit the local properties.</span>
            <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span> <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1"># NOTE: This will not fail immediately in a batch. However, when</span>
            <span class="c1">#       Batch.finish() is called, the resulting `NotFound` will be</span>
            <span class="c1">#       raised.</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">NotFound</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Blob.delete"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes a blob from Cloud Storage.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :rtype: :class:`Blob`</span>
<span class="sd">        :returns: The blob that was just deleted.</span>
<span class="sd">        :raises: :class:`google.cloud.exceptions.NotFound`</span>
<span class="sd">                 (propagated from</span>
<span class="sd">                 :meth:`google.cloud.storage.bucket.Bucket.delete_blob`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">delete_blob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_transport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the client&#39;s transport.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :rtype transport:</span>
<span class="sd">            :class:`~google.auth.transport.requests.AuthorizedSession`</span>
<span class="sd">        :returns: The transport (with credentials) that will</span>
<span class="sd">                  make authenticated requests.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">_http</span>

    <span class="k">def</span> <span class="nf">_get_download_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the download URL for the current blob.</span>

<span class="sd">        If the ``media_link`` has been loaded, it will be used, otherwise</span>
<span class="sd">        the URL will be constructed from the current blob&#39;s path (and possibly</span>
<span class="sd">        generation) to avoid a round trip.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: The download URL for the current blob.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_value_pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">media_link</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="n">_DOWNLOAD_URL_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="s1">&#39;generation&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">media_link</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;userProject&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">_add_query_parameters</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">name_value_pairs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transport</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">,</span> <span class="n">download_url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span>
                     <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a download without any error handling.</span>

<span class="sd">        This is intended to be called by :meth:`download_to_file` so it can</span>
<span class="sd">        be wrapped with error handling / remapping.</span>

<span class="sd">        :type transport:</span>
<span class="sd">            :class:`~google.auth.transport.requests.AuthorizedSession`</span>
<span class="sd">        :param transport: The transport (with credentials) that will</span>
<span class="sd">                          make authenticated requests.</span>

<span class="sd">        :type file_obj: file</span>
<span class="sd">        :param file_obj: A file handle to which to write the blob&#39;s data.</span>

<span class="sd">        :type download_url: str</span>
<span class="sd">        :param download_url: The URL where the media can be accessed.</span>

<span class="sd">        :type headers: dict</span>
<span class="sd">        :param headers: Optional headers to be sent with the request(s).</span>

<span class="sd">        :type start: int</span>
<span class="sd">        :param start: Optional, the first byte in a range to be downloaded.</span>

<span class="sd">        :type end: int</span>
<span class="sd">        :param end: Optional, The last byte in a range to be downloaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">download</span> <span class="o">=</span> <span class="n">Download</span><span class="p">(</span>
                <span class="n">download_url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">file_obj</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
            <span class="n">download</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">download</span> <span class="o">=</span> <span class="n">ChunkedDownload</span><span class="p">(</span>
                <span class="n">download_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start</span> <span class="k">if</span> <span class="n">start</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="n">download</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="n">download</span><span class="o">.</span><span class="n">consume_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>

<div class="viewcode-block" id="Blob.download_to_file"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.download_to_file">[docs]</a>    <span class="k">def</span> <span class="nf">download_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Download the contents of this blob into a file-like object.</span>

<span class="sd">        .. note::</span>

<span class="sd">           If the server-set property, :attr:`media_link`, is not yet</span>
<span class="sd">           initialized, makes an additional API request to load it.</span>

<span class="sd">        Downloading a file that has been encrypted with a `customer-supplied`_</span>
<span class="sd">        encryption key:</span>

<span class="sd">         .. literalinclude:: snippets.py</span>
<span class="sd">            :start-after: [START download_to_file]</span>
<span class="sd">            :end-before: [END download_to_file]</span>
<span class="sd">            :dedent: 4</span>

<span class="sd">        The ``encryption_key`` should be a str or bytes with a length of at</span>
<span class="sd">        least 32.</span>

<span class="sd">        For more fine-grained control over the download process, check out</span>
<span class="sd">        `google-resumable-media`_. For example, this library allows</span>
<span class="sd">        downloading **parts** of a blob rather than the whole thing.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type file_obj: file</span>
<span class="sd">        :param file_obj: A file handle to which to write the blob&#39;s data.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type start: int</span>
<span class="sd">        :param start: Optional, the first byte in a range to be downloaded.</span>

<span class="sd">        :type end: int</span>
<span class="sd">        :param end: Optional, The last byte in a range to be downloaded.</span>

<span class="sd">        :raises: :class:`google.cloud.exceptions.NotFound`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">download_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_download_url</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">_get_encryption_headers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encryption_key</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">[</span><span class="s1">&#39;accept-encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gzip&#39;</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transport</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_download</span><span class="p">(</span>
                <span class="n">transport</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">,</span> <span class="n">download_url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">resumable_media</span><span class="o">.</span><span class="n">InvalidResponse</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">_raise_from_invalid_response</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.download_to_filename"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.download_to_filename">[docs]</a>    <span class="k">def</span> <span class="nf">download_to_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Download the contents of this blob into a named file.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type filename: str</span>
<span class="sd">        :param filename: A filename to be passed to ``open``.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type start: int</span>
<span class="sd">        :param start: Optional, the first byte in a range to be downloaded.</span>

<span class="sd">        :type end: int</span>
<span class="sd">        :param end: Optional, The last byte in a range to be downloaded.</span>

<span class="sd">        :raises: :class:`google.cloud.exceptions.NotFound`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_obj</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_to_file</span><span class="p">(</span>
                    <span class="n">file_obj</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">resumable_media</span><span class="o">.</span><span class="n">DataCorruption</span><span class="p">:</span>
            <span class="c1"># Delete the corrupt downloaded file.</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="n">updated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated</span>
        <span class="k">if</span> <span class="n">updated</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">updated</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
            <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">file_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">mtime</span><span class="p">,</span> <span class="n">mtime</span><span class="p">))</span></div>

<div class="viewcode-block" id="Blob.download_as_string"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.download_as_string">[docs]</a>    <span class="k">def</span> <span class="nf">download_as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Download the contents of this blob as a string.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type start: int</span>
<span class="sd">        :param start: Optional, the first byte in a range to be downloaded.</span>

<span class="sd">        :type end: int</span>
<span class="sd">        :param end: Optional, The last byte in a range to be downloaded.</span>

<span class="sd">        :rtype: bytes</span>
<span class="sd">        :returns: The data stored in this blob.</span>
<span class="sd">        :raises: :class:`google.cloud.exceptions.NotFound`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">string_buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_to_file</span><span class="p">(</span>
            <span class="n">string_buffer</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string_buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_get_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the content type from the current object.</span>

<span class="sd">        The return value will be determined in order of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: (Optional) type of content.</span>

<span class="sd">        :type filename: str</span>
<span class="sd">        :param filename: (Optional) The name of the file where the content</span>
<span class="sd">                         is stored.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: Type of content gathered from the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_type</span>

        <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">content_type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">_DEFAULT_CONTENT_TYPE</span>

        <span class="k">return</span> <span class="n">content_type</span>

    <span class="k">def</span> <span class="nf">_get_writable_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the object / blob metadata which is writable.</span>

<span class="sd">        This is intended to be used when creating a new object / blob.</span>

<span class="sd">        See the `API reference docs`_ for more information, the fields</span>
<span class="sd">        marked as writable are:</span>

<span class="sd">        * ``acl``</span>
<span class="sd">        * ``cacheControl``</span>
<span class="sd">        * ``contentDisposition``</span>
<span class="sd">        * ``contentEncoding``</span>
<span class="sd">        * ``contentLanguage``</span>
<span class="sd">        * ``contentType``</span>
<span class="sd">        * ``crc32c``</span>
<span class="sd">        * ``md5Hash``</span>
<span class="sd">        * ``metadata``</span>
<span class="sd">        * ``name``</span>
<span class="sd">        * ``storageClass``</span>

<span class="sd">        For now, we don&#39;t support ``acl``, access control lists should be</span>
<span class="sd">        managed directly through :class:`ObjectACL` methods.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: This assumes `self.name` is unicode.</span>
        <span class="n">object_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_changes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_WRITABLE_FIELDS</span><span class="p">:</span>
                <span class="n">object_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">object_metadata</span>

    <span class="k">def</span> <span class="nf">_get_upload_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get required arguments for performing an upload.</span>

<span class="sd">        The content type returned will be determined in order of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Type of content being uploaded (or :data:`None`).</span>

<span class="sd">        :rtype: tuple</span>
<span class="sd">        :returns: A triple of</span>

<span class="sd">                  * A header dictionary</span>
<span class="sd">                  * An object metadata dictionary</span>
<span class="sd">                  * The ``content_type`` as a string (according to precedence)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">_get_encryption_headers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encryption_key</span><span class="p">)</span>
        <span class="n">object_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_writable_metadata</span><span class="p">()</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_content_type</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">object_metadata</span><span class="p">,</span> <span class="n">content_type</span>

    <span class="k">def</span> <span class="nf">_do_multipart_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span>
                             <span class="n">size</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a multipart upload.</span>

<span class="sd">        The content type of the upload will be determined in order</span>
<span class="sd">        of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type stream: IO[bytes]</span>
<span class="sd">        :param stream: A bytes IO object open for reading.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Type of content being uploaded (or :data:`None`).</span>

<span class="sd">        :type size: int</span>
<span class="sd">        :param size: The number of bytes to be uploaded (which will be read</span>
<span class="sd">                     from ``stream``). If not provided, the upload will be</span>
<span class="sd">                     concluded once ``stream`` is exhausted (or :data:`None`).</span>

<span class="sd">        :type num_retries: int</span>
<span class="sd">        :param num_retries: Number of upload retries. (Deprecated: This</span>
<span class="sd">                            argument will be removed in a future release.)</span>

<span class="sd">        :type predefined_acl: str</span>
<span class="sd">        :param predefined_acl: (Optional) predefined access control list</span>

<span class="sd">        :rtype: :class:`~requests.Response`</span>
<span class="sd">        :returns: The &quot;200 OK&quot; response object returned after the multipart</span>
<span class="sd">                  upload request.</span>
<span class="sd">        :raises: :exc:`ValueError` if ``size`` is not :data:`None` but the</span>
<span class="sd">                 ``stream`` has fewer than ``size`` bytes remaining.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_READ_LESS_THAN_SIZE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transport</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_upload_arguments</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">,</span> <span class="n">object_metadata</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">info</span>

        <span class="n">base_url</span> <span class="o">=</span> <span class="n">_MULTIPART_URL_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">bucket_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">name_value_pairs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;userProject&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kms_key_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;kmsKeyName&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kms_key_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">predefined_acl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;predefinedAcl&#39;</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">))</span>

        <span class="n">upload_url</span> <span class="o">=</span> <span class="n">_add_query_parameters</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">name_value_pairs</span><span class="p">)</span>
        <span class="n">upload</span> <span class="o">=</span> <span class="n">MultipartUpload</span><span class="p">(</span><span class="n">upload_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upload</span><span class="o">.</span><span class="n">_retry_strategy</span> <span class="o">=</span> <span class="n">resumable_media</span><span class="o">.</span><span class="n">RetryStrategy</span><span class="p">(</span>
                <span class="n">max_retries</span><span class="o">=</span><span class="n">num_retries</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span>
            <span class="n">transport</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">object_metadata</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">_initiate_resumable_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span>
                                   <span class="n">size</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">,</span>
                                   <span class="n">predefined_acl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">extra_headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initiate a resumable upload.</span>

<span class="sd">        The content type of the upload will be determined in order</span>
<span class="sd">        of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type stream: IO[bytes]</span>
<span class="sd">        :param stream: A bytes IO object open for reading.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Type of content being uploaded (or :data:`None`).</span>

<span class="sd">        :type size: int</span>
<span class="sd">        :param size: The number of bytes to be uploaded (which will be read</span>
<span class="sd">                     from ``stream``). If not provided, the upload will be</span>
<span class="sd">                     concluded once ``stream`` is exhausted (or :data:`None`).</span>

<span class="sd">        :type predefined_acl: str</span>
<span class="sd">        :param predefined_acl: (Optional) predefined access control list</span>

<span class="sd">        :type num_retries: int</span>
<span class="sd">        :param num_retries: Number of upload retries. (Deprecated: This</span>
<span class="sd">                            argument will be removed in a future release.)</span>

<span class="sd">        :type extra_headers: dict</span>
<span class="sd">        :param extra_headers: (Optional) Extra headers to add to standard</span>
<span class="sd">                              headers.</span>

<span class="sd">        :type chunk_size: int</span>
<span class="sd">        :param chunk_size:</span>
<span class="sd">            (Optional) Chunk size to use when creating a</span>
<span class="sd">            :class:`~google.resumable_media.requests.ResumableUpload`.</span>
<span class="sd">            If not passed, will fall back to the chunk size on the</span>
<span class="sd">            current blob.</span>

<span class="sd">        :rtype: tuple</span>
<span class="sd">        :returns:</span>
<span class="sd">            Pair of</span>

<span class="sd">            * The :class:`~google.resumable_media.requests.ResumableUpload`</span>
<span class="sd">              that was created</span>
<span class="sd">            * The ``transport`` used to initiate the upload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chunk_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span>
            <span class="k">if</span> <span class="n">chunk_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">_DEFAULT_CHUNKSIZE</span>

        <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transport</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_upload_arguments</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">,</span> <span class="n">object_metadata</span><span class="p">,</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">info</span>
        <span class="k">if</span> <span class="n">extra_headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_headers</span><span class="p">)</span>

        <span class="n">base_url</span> <span class="o">=</span> <span class="n">_RESUMABLE_URL_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">bucket_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">name_value_pairs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;userProject&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kms_key_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;kmsKeyName&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kms_key_name</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">predefined_acl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name_value_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;predefinedAcl&#39;</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">))</span>

        <span class="n">upload_url</span> <span class="o">=</span> <span class="n">_add_query_parameters</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">name_value_pairs</span><span class="p">)</span>
        <span class="n">upload</span> <span class="o">=</span> <span class="n">ResumableUpload</span><span class="p">(</span><span class="n">upload_url</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upload</span><span class="o">.</span><span class="n">_retry_strategy</span> <span class="o">=</span> <span class="n">resumable_media</span><span class="o">.</span><span class="n">RetryStrategy</span><span class="p">(</span>
                <span class="n">max_retries</span><span class="o">=</span><span class="n">num_retries</span><span class="p">)</span>

        <span class="n">upload</span><span class="o">.</span><span class="n">initiate</span><span class="p">(</span>
            <span class="n">transport</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">object_metadata</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span>
            <span class="n">total_bytes</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">stream_final</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">upload</span><span class="p">,</span> <span class="n">transport</span>

    <span class="k">def</span> <span class="nf">_do_resumable_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span>
                             <span class="n">size</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform a resumable upload.</span>

<span class="sd">        Assumes ``chunk_size`` is not :data:`None` on the current blob.</span>

<span class="sd">        The content type of the upload will be determined in order</span>
<span class="sd">        of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type stream: IO[bytes]</span>
<span class="sd">        :param stream: A bytes IO object open for reading.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Type of content being uploaded (or :data:`None`).</span>

<span class="sd">        :type size: int</span>
<span class="sd">        :param size: The number of bytes to be uploaded (which will be read</span>
<span class="sd">                     from ``stream``). If not provided, the upload will be</span>
<span class="sd">                     concluded once ``stream`` is exhausted (or :data:`None`).</span>

<span class="sd">        :type num_retries: int</span>
<span class="sd">        :param num_retries: Number of upload retries. (Deprecated: This</span>
<span class="sd">                            argument will be removed in a future release.)</span>

<span class="sd">        :type predefined_acl: str</span>
<span class="sd">        :param predefined_acl: (Optional) predefined access control list</span>

<span class="sd">        :rtype: :class:`~requests.Response`</span>
<span class="sd">        :returns: The &quot;200 OK&quot; response object returned after the final chunk</span>
<span class="sd">                  is uploaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">upload</span><span class="p">,</span> <span class="n">transport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiate_resumable_upload</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">,</span>
            <span class="n">predefined_acl</span><span class="o">=</span><span class="n">predefined_acl</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">upload</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">transmit_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">_do_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span>
                   <span class="n">size</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine an upload strategy and then perform the upload.</span>

<span class="sd">        If the size of the data to be uploaded exceeds 5 MB a resumable media</span>
<span class="sd">        request will be used, otherwise the content and the metadata will be</span>
<span class="sd">        uploaded in a single multipart upload request.</span>

<span class="sd">        The content type of the upload will be determined in order</span>
<span class="sd">        of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type stream: IO[bytes]</span>
<span class="sd">        :param stream: A bytes IO object open for reading.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Type of content being uploaded (or :data:`None`).</span>

<span class="sd">        :type size: int</span>
<span class="sd">        :param size: The number of bytes to be uploaded (which will be read</span>
<span class="sd">                     from ``stream``). If not provided, the upload will be</span>
<span class="sd">                     concluded once ``stream`` is exhausted (or :data:`None`).</span>

<span class="sd">        :type num_retries: int</span>
<span class="sd">        :param num_retries: Number of upload retries. (Deprecated: This</span>
<span class="sd">                            argument will be removed in a future release.)</span>

<span class="sd">        :type predefined_acl: str</span>
<span class="sd">        :param predefined_acl: (Optional) predefined access control list</span>

<span class="sd">        :rtype: dict</span>
<span class="sd">        :returns: The parsed JSON from the &quot;200 OK&quot; response. This will be the</span>
<span class="sd">                  **only** response in the multipart case and it will be the</span>
<span class="sd">                  **final** response in the resumable case.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="n">_MAX_MULTIPART_SIZE</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_multipart_upload</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span>
                <span class="n">size</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_resumable_upload</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
                <span class="n">num_retries</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<div class="viewcode-block" id="Blob.upload_from_file"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.upload_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">upload_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_retries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">predefined_acl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Upload the contents of this blob from a file-like object.</span>

<span class="sd">        The content type of the upload will be determined in order</span>
<span class="sd">        of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        .. note::</span>
<span class="sd">           The effect of uploading to an existing blob depends on the</span>
<span class="sd">           &quot;versioning&quot; and &quot;lifecycle&quot; policies defined on the blob&#39;s</span>
<span class="sd">           bucket.  In the absence of those policies, upload will</span>
<span class="sd">           overwrite any existing contents.</span>

<span class="sd">           See the `object versioning`_ and `lifecycle`_ API documents</span>
<span class="sd">           for details.</span>

<span class="sd">        Uploading a file with a `customer-supplied`_ encryption key:</span>

<span class="sd">        .. literalinclude:: snippets.py</span>
<span class="sd">            :start-after: [START upload_from_file]</span>
<span class="sd">            :end-before: [END upload_from_file]</span>
<span class="sd">            :dedent: 4</span>

<span class="sd">        The ``encryption_key`` should be a str or bytes with a length of at</span>
<span class="sd">        least 32.</span>

<span class="sd">        For more fine-grained over the upload process, check out</span>
<span class="sd">        `google-resumable-media`_.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type file_obj: file</span>
<span class="sd">        :param file_obj: A file handle open for reading.</span>

<span class="sd">        :type rewind: bool</span>
<span class="sd">        :param rewind: If True, seek to the beginning of the file handle before</span>
<span class="sd">                       writing the file to Cloud Storage.</span>

<span class="sd">        :type size: int</span>
<span class="sd">        :param size: The number of bytes to be uploaded (which will be read</span>
<span class="sd">                     from ``file_obj``). If not provided, the upload will be</span>
<span class="sd">                     concluded once ``file_obj`` is exhausted.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Optional type of content being uploaded.</span>

<span class="sd">        :type num_retries: int</span>
<span class="sd">        :param num_retries: Number of upload retries. (Deprecated: This</span>
<span class="sd">                            argument will be removed in a future release.)</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type predefined_acl: str</span>
<span class="sd">        :param predefined_acl: (Optional) predefined access control list</span>

<span class="sd">        :raises: :class:`~google.cloud.exceptions.GoogleCloudError`</span>
<span class="sd">                 if the upload response returns an error status.</span>

<span class="sd">        .. _object versioning: https://cloud.google.com/storage/\</span>
<span class="sd">                               docs/object-versioning</span>
<span class="sd">        .. _lifecycle: https://cloud.google.com/storage/docs/lifecycle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="n">_NUM_RETRIES_MESSAGE</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">_maybe_rewind</span><span class="p">(</span><span class="n">file_obj</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">)</span>
        <span class="n">predefined_acl</span> <span class="o">=</span> <span class="n">ACL</span><span class="o">.</span><span class="n">validate_predefined</span><span class="p">(</span><span class="n">predefined_acl</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">created_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_upload</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span>
                <span class="n">size</span><span class="p">,</span> <span class="n">num_retries</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">created_json</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">resumable_media</span><span class="o">.</span><span class="n">InvalidResponse</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">_raise_from_invalid_response</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.upload_from_filename"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.upload_from_filename">[docs]</a>    <span class="k">def</span> <span class="nf">upload_from_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">predefined_acl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Upload this blob&#39;s contents from the content of a named file.</span>

<span class="sd">        The content type of the upload will be determined in order</span>
<span class="sd">        of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The value given by ``mimetypes.guess_type``</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        .. note::</span>
<span class="sd">           The effect of uploading to an existing blob depends on the</span>
<span class="sd">           &quot;versioning&quot; and &quot;lifecycle&quot; policies defined on the blob&#39;s</span>
<span class="sd">           bucket.  In the absence of those policies, upload will</span>
<span class="sd">           overwrite any existing contents.</span>

<span class="sd">           See the `object versioning</span>
<span class="sd">           &lt;https://cloud.google.com/storage/docs/object-versioning&gt;`_ and</span>
<span class="sd">           `lifecycle &lt;https://cloud.google.com/storage/docs/lifecycle&gt;`_</span>
<span class="sd">           API documents for details.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type filename: str</span>
<span class="sd">        :param filename: The path to the file.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Optional type of content being uploaded.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type predefined_acl: str</span>
<span class="sd">        :param predefined_acl: (Optional) predefined access control list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_content_type</span><span class="p">(</span><span class="n">content_type</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_obj</span><span class="p">:</span>
            <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fstat</span><span class="p">(</span><span class="n">file_obj</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span><span class="o">.</span><span class="n">st_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upload_from_file</span><span class="p">(</span>
                <span class="n">file_obj</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="n">total_bytes</span><span class="p">,</span> <span class="n">predefined_acl</span><span class="o">=</span><span class="n">predefined_acl</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.upload_from_string"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.upload_from_string">[docs]</a>    <span class="k">def</span> <span class="nf">upload_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">predefined_acl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Upload contents of this blob from the provided string.</span>

<span class="sd">        .. note::</span>
<span class="sd">           The effect of uploading to an existing blob depends on the</span>
<span class="sd">           &quot;versioning&quot; and &quot;lifecycle&quot; policies defined on the blob&#39;s</span>
<span class="sd">           bucket.  In the absence of those policies, upload will</span>
<span class="sd">           overwrite any existing contents.</span>

<span class="sd">           See the `object versioning</span>
<span class="sd">           &lt;https://cloud.google.com/storage/docs/object-versioning&gt;`_ and</span>
<span class="sd">           `lifecycle &lt;https://cloud.google.com/storage/docs/lifecycle&gt;`_</span>
<span class="sd">           API documents for details.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type data: bytes or str</span>
<span class="sd">        :param data: The data to store in this blob.  If the value is</span>
<span class="sd">                     text, it will be encoded as UTF-8.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: Optional type of content being uploaded. Defaults</span>
<span class="sd">                             to ``&#39;text/plain&#39;``.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :type predefined_acl: str</span>
<span class="sd">        :param predefined_acl: (Optional) predefined access control list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_to_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">string_buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_from_file</span><span class="p">(</span>
            <span class="n">file_obj</span><span class="o">=</span><span class="n">string_buffer</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
            <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">,</span>
            <span class="n">predefined_acl</span><span class="o">=</span><span class="n">predefined_acl</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.create_resumable_upload_session"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.create_resumable_upload_session">[docs]</a>    <span class="k">def</span> <span class="nf">create_resumable_upload_session</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a resumable upload session.</span>

<span class="sd">        Resumable upload sessions allow you to start an upload session from</span>
<span class="sd">        one client and complete the session in another. This method is called</span>
<span class="sd">        by the initiator to set the metadata and limits. The initiator then</span>
<span class="sd">        passes the session URL to the client that will upload the binary data.</span>
<span class="sd">        The client performs a PUT request on the session URL to complete the</span>
<span class="sd">        upload. This process allows untrusted clients to upload to an</span>
<span class="sd">        access-controlled bucket. For more details, see the</span>
<span class="sd">        `documentation on signed URLs`_.</span>

<span class="sd">        .. _documentation on signed URLs:</span>
<span class="sd">            https://cloud.google.com/storage/\</span>
<span class="sd">            docs/access-control/signed-urls#signing-resumable</span>

<span class="sd">        The content type of the upload will be determined in order</span>
<span class="sd">        of precedence:</span>

<span class="sd">        - The value passed in to this method (if not :data:`None`)</span>
<span class="sd">        - The value stored on the current blob</span>
<span class="sd">        - The default value (&#39;application/octet-stream&#39;)</span>

<span class="sd">        .. note::</span>
<span class="sd">           The effect of uploading to an existing blob depends on the</span>
<span class="sd">           &quot;versioning&quot; and &quot;lifecycle&quot; policies defined on the blob&#39;s</span>
<span class="sd">           bucket.  In the absence of those policies, upload will</span>
<span class="sd">           overwrite any existing contents.</span>

<span class="sd">           See the `object versioning</span>
<span class="sd">           &lt;https://cloud.google.com/storage/docs/object-versioning&gt;`_ and</span>
<span class="sd">           `lifecycle &lt;https://cloud.google.com/storage/docs/lifecycle&gt;`_</span>
<span class="sd">           API documents for details.</span>

<span class="sd">        If :attr:`encryption_key` is set, the blob will be encrypted with</span>
<span class="sd">        a `customer-supplied`_ encryption key.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type size: int</span>
<span class="sd">        :param size: (Optional). The maximum number of bytes that can be</span>
<span class="sd">                     uploaded using this session. If the size is not known</span>
<span class="sd">                     when creating the session, this should be left blank.</span>

<span class="sd">        :type content_type: str</span>
<span class="sd">        :param content_type: (Optional) Type of content being uploaded.</span>

<span class="sd">        :type origin: str</span>
<span class="sd">        :param origin: (Optional) If set, the upload can only be completed</span>
<span class="sd">                       by a user-agent that uploads from the given origin. This</span>
<span class="sd">                       can be useful when passing the session to a web client.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: (Optional) The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        :returns: The resumable upload session URL. The upload can be</span>
<span class="sd">                  completed by making an HTTP PUT request with the</span>
<span class="sd">                  file&#39;s contents.</span>

<span class="sd">        :raises: :class:`google.cloud.exceptions.GoogleCloudError`</span>
<span class="sd">                 if the session creation response returns an error status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This header is specifically for client-side uploads, it</span>
            <span class="c1"># determines the origins allowed for CORS.</span>
            <span class="n">extra_headers</span><span class="p">[</span><span class="s1">&#39;Origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">dummy_stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="c1"># Send a fake the chunk size which we **know** will be acceptable</span>
            <span class="c1"># to the `ResumableUpload` constructor. The chunk size only</span>
            <span class="c1"># matters when **sending** bytes to an upload.</span>
            <span class="n">upload</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initiate_resumable_upload</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span> <span class="n">dummy_stream</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">predefined_acl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">extra_headers</span><span class="o">=</span><span class="n">extra_headers</span><span class="p">,</span>
                <span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_CHUNK_SIZE_MULTIPLE</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">upload</span><span class="o">.</span><span class="n">resumable_url</span>
        <span class="k">except</span> <span class="n">resumable_media</span><span class="o">.</span><span class="n">InvalidResponse</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">_raise_from_invalid_response</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.get_iam_policy"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.get_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">get_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the IAM policy for the object.</span>

<span class="sd">        .. note:</span>

<span class="sd">           Blob- / object-level IAM support does not yet exist and methods</span>
<span class="sd">           currently call an internal ACL backend not providing any utility</span>
<span class="sd">           beyond the blob&#39;s :attr:`acl` at this time. The API may be enhanced</span>
<span class="sd">           in the future and is currently undocumented. Use :attr:`acl` for</span>
<span class="sd">           managing object access control.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current object&#39;s bucket.</span>

<span class="sd">        :rtype: :class:`google.cloud.iam.Policy`</span>
<span class="sd">        :returns: the policy instance, based on the resource returned from</span>
<span class="sd">                  the ``getIamPolicy`` API request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;userProject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/iam&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,),</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Policy</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.set_iam_policy"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.set_iam_policy">[docs]</a>    <span class="k">def</span> <span class="nf">set_iam_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the IAM policy for the bucket.</span>

<span class="sd">        .. note:</span>

<span class="sd">           Blob- / object-level IAM support does not yet exist and methods</span>
<span class="sd">           currently call an internal ACL backend not providing any utility</span>
<span class="sd">           beyond the blob&#39;s :attr:`acl` at this time. The API may be enhanced</span>
<span class="sd">           in the future and is currently undocumented. Use :attr:`acl` for</span>
<span class="sd">           managing object access control.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type policy: :class:`google.cloud.iam.Policy`</span>
<span class="sd">        :param policy: policy instance used to update bucket&#39;s IAM policy.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: :class:`google.cloud.iam.Policy`</span>
<span class="sd">        :returns: the policy instance, based on the resource returned from</span>
<span class="sd">                  the ``setIamPolicy`` API request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;userProject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">resource</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">to_api_repr</span><span class="p">()</span>
        <span class="n">resource</span><span class="p">[</span><span class="s1">&#39;resourceId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/iam&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,),</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">resource</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Policy</span><span class="o">.</span><span class="n">from_api_repr</span><span class="p">(</span><span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.test_iam_permissions"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.test_iam_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">test_iam_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permissions</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;API call:  test permissions</span>

<span class="sd">        .. note:</span>

<span class="sd">           Blob- / object-level IAM support does not yet exist and methods</span>
<span class="sd">           currently call an internal ACL backend not providing any utility</span>
<span class="sd">           beyond the blob&#39;s :attr:`acl` at this time. The API may be enhanced</span>
<span class="sd">           in the future and is currently undocumented. Use :attr:`acl` for</span>
<span class="sd">           managing object access control.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type permissions: list of string</span>
<span class="sd">        :param permissions: the permissions to check</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the current bucket.</span>

<span class="sd">        :rtype: list of string</span>
<span class="sd">        :returns: the permissions returned by the ``testIamPermissions`` API</span>
<span class="sd">                  request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;permissions&#39;</span><span class="p">:</span> <span class="n">permissions</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;userProject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/iam/testPermissions&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;permissions&#39;</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="Blob.make_public"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.make_public">[docs]</a>    <span class="k">def</span> <span class="nf">make_public</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update blob&#39;s ACL, granting read access to anonymous users.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">grant_read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.make_private"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.make_private">[docs]</a>    <span class="k">def</span> <span class="nf">make_private</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update blob&#39;s ACL, revoking read access for anonymous users.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">revoke_read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.compose"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.compose">[docs]</a>    <span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Concatenate source blobs into this one.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type sources: list of :class:`Blob`</span>
<span class="sd">        :param sources: blobs whose contents will be composed into this blob.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;userProject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sourceObjects&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="p">}</span> <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">],</span>
            <span class="s1">&#39;destination&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">api_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/compose&#39;</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">api_response</span><span class="p">)</span></div>

<div class="viewcode-block" id="Blob.rewrite"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.rewrite">[docs]</a>    <span class="k">def</span> <span class="nf">rewrite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rewrite source blob into this one.</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type source: :class:`Blob`</span>
<span class="sd">        :param source: blob whose contents will be rewritten into this blob.</span>

<span class="sd">        :type token: str</span>
<span class="sd">        :param token: Optional. Token returned from an earlier, not-completed</span>
<span class="sd">                       call to rewrite the same source blob.  If passed,</span>
<span class="sd">                       result will include updated status, total bytes written.</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client` or</span>
<span class="sd">                      ``NoneType``</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>

<span class="sd">        :rtype: tuple</span>
<span class="sd">        :returns: ``(token, bytes_rewritten, total_bytes)``, where ``token``</span>
<span class="sd">                  is a rewrite token (``None`` if the rewrite is complete),</span>
<span class="sd">                  ``bytes_rewritten`` is the number of bytes rewritten so far,</span>
<span class="sd">                  and ``total_bytes`` is the total number of bytes to be</span>
<span class="sd">                  rewritten.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">_get_encryption_headers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encryption_key</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_get_encryption_headers</span><span class="p">(</span>
            <span class="n">source</span><span class="o">.</span><span class="n">_encryption_key</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;rewriteToken&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;userProject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kms_key_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;destinationKmsKeyName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kms_key_name</span>

        <span class="n">api_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/rewriteTo&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">rewritten</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">api_response</span><span class="p">[</span><span class="s1">&#39;totalBytesRewritten&#39;</span><span class="p">])</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">api_response</span><span class="p">[</span><span class="s1">&#39;objectSize&#39;</span><span class="p">])</span>

        <span class="c1"># The resource key is set if and only if the API response is</span>
        <span class="c1"># completely done. Additionally, there is no rewrite token to return</span>
        <span class="c1"># in this case.</span>
        <span class="k">if</span> <span class="n">api_response</span><span class="p">[</span><span class="s1">&#39;done&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">api_response</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rewritten</span><span class="p">,</span> <span class="n">size</span>

        <span class="k">return</span> <span class="n">api_response</span><span class="p">[</span><span class="s1">&#39;rewriteToken&#39;</span><span class="p">],</span> <span class="n">rewritten</span><span class="p">,</span> <span class="n">size</span></div>

<div class="viewcode-block" id="Blob.update_storage_class"><a class="viewcode-back" href="../../../../storage/blobs.html#google.cloud.storage.blob.Blob.update_storage_class">[docs]</a>    <span class="k">def</span> <span class="nf">update_storage_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_class</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update blob&#39;s storage class via a rewrite-in-place.</span>

<span class="sd">        See</span>
<span class="sd">        https://cloud.google.com/storage/docs/per-object-storage-class</span>

<span class="sd">        If :attr:`user_project` is set on the bucket, bills the API request</span>
<span class="sd">        to that project.</span>

<span class="sd">        :type new_class: str</span>
<span class="sd">        :param new_class: new storage class for the object</span>

<span class="sd">        :type client: :class:`~google.cloud.storage.client.Client`</span>
<span class="sd">        :param client: Optional. The client to use.  If not passed, falls back</span>
<span class="sd">                       to the ``client`` stored on the blob&#39;s bucket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_class</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_STORAGE_CLASSES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid storage class: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">new_class</span><span class="p">,))</span>

        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_client</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="n">query_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_params</span><span class="p">[</span><span class="s1">&#39;userProject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_project</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="n">_get_encryption_headers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encryption_key</span><span class="p">)</span>
        <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_get_encryption_headers</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_encryption_key</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">api_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">api_request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;/rewriteTo&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
            <span class="n">query_params</span><span class="o">=</span><span class="n">query_params</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;storageClass&#39;</span><span class="p">:</span> <span class="n">new_class</span><span class="p">},</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">_target_object</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_properties</span><span class="p">(</span><span class="n">api_response</span><span class="p">[</span><span class="s1">&#39;resource&#39;</span><span class="p">])</span></div>

    <span class="n">cache_control</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;cacheControl&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;HTTP &#39;Cache-Control&#39; header for this object.</span>

<span class="sd">    See `RFC 7234`_ and `API reference docs`_.</span>

<span class="sd">    :rtype: str or ``NoneType``</span>

<span class="sd">    .. _RFC 7234: https://tools.ietf.org/html/rfc7234#section-5.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">content_disposition</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;contentDisposition&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;HTTP &#39;Content-Disposition&#39; header for this object.</span>

<span class="sd">    See `RFC 6266`_ and `API reference docs`_.</span>

<span class="sd">    :rtype: str or ``NoneType``</span>

<span class="sd">    .. _RFC 6266: https://tools.ietf.org/html/rfc7234#section-5.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">content_encoding</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;contentEncoding&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;HTTP &#39;Content-Encoding&#39; header for this object.</span>

<span class="sd">    See `RFC 7231`_ and `API reference docs`_.</span>

<span class="sd">    :rtype: str or ``NoneType``</span>

<span class="sd">    .. _RFC 7231: https://tools.ietf.org/html/rfc7231#section-3.1.2.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">content_language</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;contentLanguage&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;HTTP &#39;Content-Language&#39; header for this object.</span>

<span class="sd">    See `BCP47`_ and `API reference docs`_.</span>

<span class="sd">    :rtype: str or ``NoneType``</span>

<span class="sd">    .. _BCP47: https://tools.ietf.org/html/bcp47</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="n">_CONTENT_TYPE_FIELD</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;HTTP &#39;Content-Type&#39; header for this object.</span>

<span class="sd">    See `RFC 2616`_ and `API reference docs`_.</span>

<span class="sd">    :rtype: str or ``NoneType``</span>

<span class="sd">    .. _RFC 2616: https://tools.ietf.org/html/rfc2616#section-14.17</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">crc32c</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;crc32c&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;CRC32C checksum for this object.</span>

<span class="sd">    See `RFC 4960`_ and `API reference docs`_.</span>

<span class="sd">    If not set before upload, the server will compute the hash.</span>

<span class="sd">    :rtype: str or ``NoneType``</span>

<span class="sd">    .. _RFC 4960: https://tools.ietf.org/html/rfc4960#appendix-B</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">component_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of underlying components that make up this object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: The component count (in case of a composed object) or</span>
<span class="sd">                  ``None`` if the blob&#39;s resource has not been loaded from</span>
<span class="sd">                  the server.  This property will not be set on objects</span>
<span class="sd">                  not created via ``compose``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">component_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;componentCount&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">component_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">component_count</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">etag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the ETag for the object.</span>

<span class="sd">        See `RFC 2616 (etags)`_ and `API reference docs`_.</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: The blob etag or ``None`` if the blob&#39;s resource has not</span>
<span class="sd">                  been loaded from the server.</span>

<span class="sd">        .. _RFC 2616 (etags): https://tools.ietf.org/html/rfc2616#section-3.11</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;etag&#39;</span><span class="p">)</span>

    <span class="n">event_based_hold</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;eventBasedHold&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Is an event-based hold active on the object?</span>

<span class="sd">    See `API reference docs`_.</span>

<span class="sd">    If the property is not set locally, returns :data:`None`.</span>

<span class="sd">    :rtype: bool or ``NoneType``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the generation for the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: The generation of the blob or ``None`` if the blob&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">generation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;generation&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">generation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">generation</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the ID for the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        The ID consists of the bucket name, object name, and generation number.</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: The ID of the blob or ``None`` if the blob&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

    <span class="n">md5_hash</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;md5Hash&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;MD5 hash for this object.</span>

<span class="sd">    See `RFC 1321`_ and `API reference docs`_.</span>

<span class="sd">    If not set before upload, the server will compute the hash.</span>

<span class="sd">    :rtype: str or ``NoneType``</span>

<span class="sd">    .. _RFC 1321: https://tools.ietf.org/html/rfc1321</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">media_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the media download URI for the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: The media link for the blob or ``None`` if the blob&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mediaLink&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve arbitrary/application specific metadata for the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :setter: Update arbitrary/application specific metadata for the</span>
<span class="sd">                 object.</span>
<span class="sd">        :getter: Retrieve arbitrary/application specific metadata for</span>
<span class="sd">                 the object.</span>

<span class="sd">        :rtype: dict or ``NoneType``</span>
<span class="sd">        :returns: The metadata associated with the blob or ``None`` if the</span>
<span class="sd">                  property is not set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">))</span>

    <span class="nd">@metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update arbitrary/application specific metadata for the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :type value: dict</span>
<span class="sd">        :param value: (Optional) The blob metadata to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patch_property</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metageneration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the metageneration for the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: The metageneration of the blob or ``None`` if the blob&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metageneration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;metageneration&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metageneration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">metageneration</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve info about the owner of the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: dict or ``NoneType``</span>
<span class="sd">        :returns: Mapping of owner&#39;s role/ID, or ``None`` if the blob&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;owner&#39;</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">retention_expiration_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve timestamp at which the object&#39;s retention period expires.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: :class:`datetime.datetime` or ``NoneType``</span>
<span class="sd">        :returns: Datetime object parsed from RFC3339 valid timestamp, or</span>
<span class="sd">                  ``None`` if the property is not set locally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retentionExpirationTime&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_rfc3339_to_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">self_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the URI for the object.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns: The self link for the blob or ``None`` if the blob&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selfLink&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Size of the object, in bytes.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: int or ``NoneType``</span>
<span class="sd">        :returns: The size of the blob or ``None`` if the blob&#39;s</span>
<span class="sd">                  resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">kms_key_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resource name of Cloud KMS key used to encrypt the blob&#39;s contents.</span>

<span class="sd">        :rtype: str or ``NoneType``</span>
<span class="sd">        :returns:</span>
<span class="sd">            The resource name or ``None`` if no Cloud KMS key was used,</span>
<span class="sd">            or the blob&#39;s resource has not been loaded from the server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kmsKeyName&#39;</span><span class="p">)</span>

    <span class="n">storage_class</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;storageClass&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Retrieve the storage class for the object.</span>

<span class="sd">    This can only be set at blob / object **creation** time. If you&#39;d</span>
<span class="sd">    like to change the storage class **after** the blob / object already</span>
<span class="sd">    exists in a bucket, call :meth:`update_storage_class` (which uses</span>
<span class="sd">    the &quot;storage.objects.rewrite&quot; method).</span>

<span class="sd">    See https://cloud.google.com/storage/docs/storage-classes</span>

<span class="sd">    :rtype: str or ``NoneType``</span>
<span class="sd">    :returns: If set, one of &quot;MULTI_REGIONAL&quot;, &quot;REGIONAL&quot;,</span>
<span class="sd">              &quot;NEARLINE&quot;, &quot;COLDLINE&quot;, &quot;STANDARD&quot;, or</span>
<span class="sd">              &quot;DURABLE_REDUCED_AVAILABILITY&quot;, else ``None``.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">temporary_hold</span> <span class="o">=</span> <span class="n">_scalar_property</span><span class="p">(</span><span class="s1">&#39;temporaryHold&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Is a temporary hold active on the object?</span>

<span class="sd">    See `API reference docs`_.</span>

<span class="sd">    If the property is not set locally, returns :data:`None`.</span>

<span class="sd">    :rtype: bool or ``NoneType``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the timestamp at which the object was deleted.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: :class:`datetime.datetime` or ``NoneType``</span>
<span class="sd">        :returns: Datetime object parsed from RFC3339 valid timestamp, or</span>
<span class="sd">                  ``None`` if the blob&#39;s resource has not been loaded from</span>
<span class="sd">                  the server (see :meth:`reload`). If the blob has</span>
<span class="sd">                  not been deleted, this will never be set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timeDeleted&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_rfc3339_to_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_created</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the timestamp at which the object was created.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: :class:`datetime.datetime` or ``NoneType``</span>
<span class="sd">        :returns: Datetime object parsed from RFC3339 valid timestamp, or</span>
<span class="sd">                  ``None`` if the blob&#39;s resource has not been loaded from</span>
<span class="sd">                  the server (see :meth:`reload`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timeCreated&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_rfc3339_to_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">updated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the timestamp at which the object was updated.</span>

<span class="sd">        See https://cloud.google.com/storage/docs/json_api/v1/objects</span>

<span class="sd">        :rtype: :class:`datetime.datetime` or ``NoneType``</span>
<span class="sd">        :returns: Datetime object parsed from RFC3339 valid timestamp, or</span>
<span class="sd">                  ``None`` if the blob&#39;s resource has not been loaded from</span>
<span class="sd">                  the server (see :meth:`reload`).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;updated&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_rfc3339_to_datetime</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_get_encryption_headers</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Builds customer encryption key headers</span>

<span class="sd">    :type key: bytes</span>
<span class="sd">    :param key: 32 byte key to build request key and hash.</span>

<span class="sd">    :type source: bool</span>
<span class="sd">    :param source: If true, return headers for the &quot;source&quot; blob; otherwise,</span>
<span class="sd">                   return headers for the &quot;destination&quot; blob.</span>

<span class="sd">    :rtype: dict</span>
<span class="sd">    :returns: dict of HTTP headers being sent in request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">_to_bytes</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">key_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="n">key_hash</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">key_hash</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;X-Goog-Copy-Source-Encryption-&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;X-Goog-Encryption-&#39;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;Algorithm&#39;</span><span class="p">:</span> <span class="s1">&#39;AES256&#39;</span><span class="p">,</span>
        <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;Key&#39;</span><span class="p">:</span> <span class="n">_bytes_to_unicode</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;Key-Sha256&#39;</span><span class="p">:</span> <span class="n">_bytes_to_unicode</span><span class="p">(</span><span class="n">key_hash</span><span class="p">),</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">_quote</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;URL-quote a string.</span>

<span class="sd">    If the value is unicode, this method first UTF-8 encodes it as bytes and</span>
<span class="sd">    then quotes the bytes. (In Python 3, ``urllib.parse.quote`` does this</span>
<span class="sd">    encoding automatically, but in Python 2, non-ASCII characters cannot be</span>
<span class="sd">    quoted.)</span>

<span class="sd">    :type value: str or bytes</span>
<span class="sd">    :param value: The value to be URL-quoted.</span>

<span class="sd">    :rtype: str</span>
<span class="sd">    :returns: The encoded value (bytes in Python 2, unicode in Python 3).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">_to_bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">quote</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_maybe_rewind</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rewind the stream if desired.</span>

<span class="sd">    :type stream: IO[bytes]</span>
<span class="sd">    :param stream: A bytes IO object open for reading.</span>

<span class="sd">    :type rewind: bool</span>
<span class="sd">    :param rewind: Indicates if we should seek to the beginning of the stream.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rewind</span><span class="p">:</span>
        <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_raise_from_invalid_response</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Re-wrap and raise an ``InvalidResponse`` exception.</span>

<span class="sd">    :type error: :exc:`google.resumable_media.InvalidResponse`</span>
<span class="sd">    :param error: A caught exception from the ``google-resumable-media``</span>
<span class="sd">                  library.</span>

<span class="sd">    :raises: :class:`~google.cloud.exceptions.GoogleCloudError` corresponding</span>
<span class="sd">             to the failed status code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">response</span>
    <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="si">{method}</span><span class="s1"> </span><span class="si">{url}</span><span class="s1">: </span><span class="si">{error}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
        <span class="n">error</span><span class="o">=</span><span class="n">error_message</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">from_http_status</span><span class="p">(</span>
        <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_add_query_parameters</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">name_value_pairs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add one query parameter to a base URL.</span>

<span class="sd">    :type base_url: string</span>
<span class="sd">    :param base_url: Base URL (may already contain query parameters)</span>

<span class="sd">    :type name_value_pairs: list of (string, string) tuples.</span>
<span class="sd">    :param name_value_pairs: Names and values of the query parameters to add</span>

<span class="sd">    :rtype: string</span>
<span class="sd">    :returns: URL with additional query strings appended.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_value_pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">base_url</span>

    <span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">frag</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">parse_qsl</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">query</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">name_value_pairs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">urlunsplit</span><span class="p">((</span><span class="n">scheme</span><span class="p">,</span> <span class="n">netloc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">frag</span><span class="p">))</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">google-cloud</a></h1>



<p class="blurb">Google Cloud Client Libraries for Python</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=GoogleCloudPlatform&repo=google-cloud-python&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../core/index.html">Core Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../asset/index.html">Asset Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../automl/index.html">AutoML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bigquery/index.html">BigQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bigquery_datatransfer/index.html">BigQuery Data-Transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bigtable/index.html">Bigtable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../container/index.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dataproc/index.html">Dataproc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../datastore/index.html">Datastore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dlp/index.html">Data Loss Prevention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dns/index.html">DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../firestore/index.html">Firestore</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../iot/index.html">IoT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kms/index.html">Key Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../language/index.html">Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pubsub/index.html">PubSub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../oslogin/index.html">OSLogin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../redis/index.html">Redis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../resource-manager/index.html">Resource Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtimeconfig/index.html">Python Client for Google Cloud RuntimeConfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../runtimeconfig/index.html#api-reference">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scheduler/index.html">Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../securitycenter/index.html">Security Center</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../websecurityscanner/index.html">Security Scanner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spanner/index.html">Spanner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../speech/index.html">Speech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../storage/index.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tasks/index.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../texttospeech/index.html">Text-to-Speech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../translate/index.html">Translate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vision/index.html">Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../videointelligence/index.html">Video Intelligence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../error-reporting/index.html">Stackdriver Error Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../logging/index.html">Stackdriver Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../monitoring/index.html">Stackdriver Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trace/index.html">Stackdriver Trace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases.html">Release History</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014-2017, Google.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    
    <a href="https://github.com/GoogleCloudPlatform/google-cloud-python" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>